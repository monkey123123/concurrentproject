<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beanpodtech.pkms.dbadapter.dao.ITaCapabilityRDao">

    <!--add by Allen -->
    <resultMap id="ResultMap_TaCapabilityR" type="com.beanpodtech.pkms.common.model.tam.TaCapabilityR" >
        <id column="TA_ID" property="taId" jdbcType="INTEGER" />
        <id column="CAPABILITY_ID" property="capabilityId" jdbcType="INTEGER" />
        <result column="DESCRIPTION" property="description" jdbcType="VARCHAR" />
        <result column="DELETE_FLAG" property="deleteFlag" jdbcType="INTEGER" />
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
        <result column="OPER_ID" property="operId" jdbcType="VARCHAR" />
        <result column="OPER_TIME" property="operTime" jdbcType="TIMESTAMP" />
    </resultMap>



    <sql id="sql_select">
        TA_ID,
        CAPABILITY_ID,
        DESCRIPTION,
        DELETE_FLAG,
        CREATE_TIME,
        OPER_ID,
        OPER_TIME
    </sql>
    <sql id="sql_insert">
        TA_ID,
        CAPABILITY_ID,
        DESCRIPTION,
        DELETE_FLAG,
        CREATE_TIME,
        OPER_ID,
        OPER_TIME
    </sql>


    <!-- 此表主键需手动指定 -->
    <insert id="insertTaCapabilityR" parameterType="TaCapabilityR" useGeneratedKeys="false" keyProperty="taId">
        INSERT INTO ta_capability_r(<include refid="sql_insert"/> )
        VALUES (#{taId},#{capabilityId},#{description},#{deleteFlag},#{createTime},#{operId},CURRENT_TIMESTAMP )
    </insert>

    <update id="updateTaCapabilityR" parameterType="TaCapabilityR">
        UPDATE ta_capability_r
        SET
            <if test="capabilityId != null">CAPABILITY_ID = #{capabilityId},</if>
            OPER_ID = #{operId},
            OPER_TIME = CURRENT_TIMESTAMP
        WHERE TA_ID = #{taId}
    </update>

<!--逻辑删除-->
    <update id="deleteTaCapabilityRLogic" parameterType="TaCapabilityR">
        UPDATE ta_capability_r
        SET DELETE_FLAG = 0
        <where>
            <if test="taId != null">
                AND TA_ID = #{taId}
            </if>
            <if test="capabilityId != null">
                AND CAPABILITY_ID = #{capabilityId}
            </if>

        </where>
    </update>

<!--真实删除-->
    <delete id="deleteTaCapabilityR" parameterType="TaCapabilityR">
        delete from ta_capability_r
        <where>
            <if test="taId != null">
                AND TA_ID = #{taId}
            </if>
            <if test="capabilityId != null">
                AND CAPABILITY_ID = #{capabilityId}
            </if>

        </where>
    </delete>

    <select id="selectByMap" parameterType="java.util.HashMap" resultMap="ResultMap_TaCapabilityR">
        SELECT <include refid="sql_select"/>
        FROM ta_capability_r
        <where>
            <if test="taId != null">
                AND TA_ID = #{taId}
            </if>
            <if test="capabilityId != null">
                AND CAPABILITY_ID = #{capabilityId}
            </if>

            <if test="deleteFlag != null">
                AND DELETE_FLAG = #{deleteFlag}
            </if>
            <if test="createTime != null">
                AND CREATE_TIME &lt;= #{createTime}
            </if>
            <if test="operId != null">
                AND OPER_ID &lt;= #{operId}
            </if>
        </where>
    </select>

    <select id="selectById" parameterType="java.util.HashMap" resultMap="ResultMap_TaCapabilityR">
        SELECT m.TA_ID,CAPABILITY_ID,TA_ID,FILE_ID,DELETE_FLAG,m.EXPIRE_TIME,m.CREATE_TIME,m.OPER_ID,m.OPER_TIME
        FROM ta_capability_r m
        <where>
            <if test="deleteFlag != null">
                AND m.DELETE_FLAG = #{deleteFlag}
            </if>
            <if test="expireTime != null">
                AND m.EXPIRE_TIME > #{expireTime}
            </if>

        </where>
    </select>

</mapper>